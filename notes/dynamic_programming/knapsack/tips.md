# Разное по Рюкзакам
## Несколько предметов одинакового веса
Пусть у нас есть рюкзак без стоимости, а сами предметы задаются 2 числами $w_i$ - вес, $c_i$ - количество предметов. Как с оптимизировать их количество до $\log{c_i}$ не изменяя ответ рюкзака?

Рассмотрим самый простой случай, когда $c_i = 2^k - 1$. Запись двоичного числа будет таковой: `00..011..1` (количество единиц равно $k$ ). Перепишем предметы таким образом, чтобы их коэффициент был равен представлению единице в данной записи.

$$
1w_i, 2w_i, 4w_i, 8w_i, \dots, 2^{k-1}w_i
$$

Для примера, при $w_i = 3, c_i = 31$, $k = 5$, а предметы:

$$
\begin{matrix}
1w_i, 2w_i, 4w_i, 8w_i, 16w_i \\
3, 6, 12, 24, 48
\end{matrix}
$$

Убедитесь, что с помощью этих предметов можно составить рюкзак размера $[0; 93] \text{ и } x \equiv 0\pmod 3$

Далее в тексте опустим $w_i$, но знайте, что на него всегда надо умножать в решении.

Что же делать если $c_i \ne 2^k - 1$? Найдём $k: 2^k - 1 \le c_i$ Я утверждаю, что достаточно добавить к предыдущему набору ещё 1 предмет весом $c_i - 2^k + 1$ Для 1-го набора можно составить все элементы $[0; 2^k - 1]$ При добавлении ещё одного элемента, диапозон значений, включающих данный элемент, смещается на величену этого элемента:

$$
\begin{matrix}
[0 + (c_i - 2^k + 1); 2^k - 1 + (c_i - 2^k + 1)] \\
[c_i - 2^k + 1; c_i]
\end{matrix}
$$

Нужно лишь доказать, что при их пересечении не останеться пустот:

$$
c_i - 2^k + 1 \le 2^k - 1
$$

Так как $k$ - максимальное такое, что $2^k - 1 \le c_i$ то 

$$
\begin{aligned}
c_i &< 2^{k+1} - 1 \\
c_i &\le 2^{k+1} - 2 \\
c_i &\le 2^k + 2^k - 1 - 1 \\
c_i - 2^k + 1 &\le 2^k-1
\end{aligned}
$$

Итоговый набор предметов:

$$
\begin{matrix}
1, 2, 4, \dots, 2^{k-1}, c_i - 2^k + 1 \\
w_i, 2w_i, 4w_i, \dots, 2^{k-1}w_i, (c_i - 2^k + 1)w_i, 
\end{matrix}
$$

Например: 

$$
\begin{matrix}
w_i = 10, c_i=13 \\ \\
k = 3 \\
1, 2, 4, 6 \\
10, 20, 40, 60
\end{matrix}
$$

Можете проверить сами.

%% TODO: добавить раздел про количество чисел корень из S %%

## Перевернуть динамику
При больших значениях $W$, но маленьких стоимостях $V$, можно *перевернуть* динамику. Теперь $f(i, v)$ - минимальный вес, который можно набрать если взять первые $i$ предметов стоимостью ровно $v$ 

$$
f(i, v) = min
\begin{cases}
0 &\text{ при } i = 0 \text{ и } v = 0 \\
\infty &\text{ при } i = 0 \text{ и } v > 0 \\
f(i - 1, v) \\
f(i - 1, v - v_i) + w_i &\text{ при } v_i > v
\end{cases}
$$

Ответом будет является последнее $v: f(n, v) \le W$

%% TODO: возможно написать про откат ДП зм 2:30, рюкзак по сумме%%
