# Пересечения
## Основная идея
В задаче пересечения мы будем пользоваться в основном **векторным** и **скалярным** произведением. Каждую операцию можно представить как определённый *фильтр*, которым мы будем отсеивать множество всех вариантов.

*Фильтр* векторного произведения:
![](/files/CrossProductFilter.png)

*Фильтр* скалярного произведения:
![](/files/DotProductFilter.png)

Также полезно определить функцию $sign$ - показывающая знак числа:

$$
sign(x) = \begin{cases}
-1 & x < 0 \\
0 & x = 0 \\
1 & x > 0
\end{cases}
$$

В основном будет рассмотрен случай, когда надо сказать *есть* или *нет* пересечения. Однако задача может быть расширена: найти само место пересечения.

## Точка
Нужно проверить, лежит ли точка $A(x, y)$ на прямой, луче или отрезке.

**Прямая.** Если прямая задана уравнением, то нужно лишь проверить что точка удовлетворяет исходному равенству $Ax + By + C = 0$.

Если же прямая задаётся точками $BC$, то нужно проверить что $\vec{BC} \times \vec{BA} = 0$

**Луч.** Всё тоже самое, что и с прямой, только теперь добавляется условие, что точка лежит *прямо* по направлению луча, с помощью скалярного произведения:

$$
\begin{aligned}
\vec{BC} \times \vec{BA} &= 0 \\
\vec{BC} \cdot \vec{BA} &\ge 0
\end{aligned}
$$

**Отрезок.** По сути тот же луч, но ограниченный с двух сторон. Проверяем, что лежит на прямой, и ограничеваем скалярным произведением уже с 2 сторон:

$$
\begin{aligned}
\vec{BC} \times \vec{BA} &= 0 \\
\vec{BC} \cdot \vec{BA} &\ge 0 \\
\vec{CB} \cdot \vec{CA} &\ge 0
\end{aligned}
$$

## Прямая
**Прямая.** Нужно проверить, что прямые $AB$ и $CD$ пересекаются. На самом деле, достаточно лишь проверить, что они не параллельны (и не совпадают), во всех остальных случаях они где-нибудь да пересекутся. Нужно проверить, что *направляющие вектора* не коллинеарны, или прямые *равны*.

$$
\begin{align}
\vec{AB} \times \vec{CD} &\ne 0 \tag{1} \\
\text{или}& \\
C \in AB \implies& \vec{AB} \times \vec{AC} = 0 \tag{2}
\end{align}
$$

Если прямая задана уравнением, то нужно узнать направляющие вектора: $(B_1, -A_1)$ и $(B_2, -A_2)$

Если же нужно найти само место пересечения:
- Если прямые совпадают, то пересечение и является данная прямая
- Если прямые не совпадают, и пересекаются, то нужно решить простую системы линейных уравнений

$$
\begin{cases}
A_1 x + B_1 y + C_1 = 0 \\
A_2 x + B_2 y + C_2 = 0
\end{cases}
\implies
\begin{cases}
-x = \cfrac{B_1 y + C_1}{A_1} \\
-x = \cfrac{B_2 y + C_2}{A_2}
\end{cases}
$$

$$
\cfrac{B_1 y + C_1}{A_1} = \cfrac{B_2 y + C_2}{A_2}
\implies
y = -\cfrac{A_1 C_2 - A_2 C_1}{A_1 B_2 - A_2 B_1}
$$

Иначе пересечений нет. Это достигается, когда знаменатель равен нулю.

**Луч.** Прямая $AB$ и луч $CD$. Задача становиться чуть сложнее, теперь добавляется условие, что луч *"смотрит"* в сторону прямой. Если начала луча лежит в какой-то полуплоскости, то направляющий вектор луча $\vec{CD}$ должен *смотреть* в другую сторону. 

$$
\left[
\begin{array}{ll}

\begin{cases}
sign(\vec{AB} \times \vec{CD}) \ne 0 \\
sign(\vec{AB} \times \vec{AC}) \ne sign(\vec{AB} \times \vec{CD})
\end{cases} \\

\begin{cases}
\vec{AB} \times \vec{CD} = 0 \\
\vec{AB} \times \vec{AC} = 0
\end{cases}

\end{array}
\right.
$$

Объяснение:
- Прямая и луч не параллельны. И луч *смотрит* в другую полуплоскость, в отличие от точки начала.
- ИЛИ прямая и луч параллельны. И точка начала лежит на прямой.

Во всех остальных случаях прямая и луч не пересекаются.

%% TODO: сделать анимацию по возможности %%

**Отрезок.** Прямая $AB$ и отрезок $CD$. Здесь нужно заметить, что если оба конца отрезка лежат в 1 полуплоскости, то и все точки отрезка будут в этой же полуплоскости, то есть пересечений не будет. 

$$
sign(\vec{AB} \times \vec{AC}) \ne sign(\vec{AB} \times \vec{AD})
$$

Не забываем про случай, когда обе точке лежат на прямой.

## Отрезок
**Отрезок.** Найти пересечение отрезка $AB$ и $CD$.

Для начала узнаем, есть ли вообще пересечения. Расширим предыдущий метод (прямая и отрезок), только теперь проверяем для каждого отрезка, лежат ли точки другого отрезка по разные стороны:

$$
\begin{cases}
sign(\vec{AB} \times \vec{AC}) \ne sign(\vec{AB} \times \vec{AD}) \\
sign(\vec{CD} \times \vec{CA}) \ne sign(\vec{CD} \times \vec{CB})
\end{cases}
$$

Оказывается, это является необходимым и достаточным условием. Также не стоит забывать про случай, когда отрезки лежат на одной прямой.

**Место пересечения.** Усложним задачу, теперь нужно найти пересечение:
- Если прямые *параллельны* $\vec{AB} \times \vec{CD} = 0$ и лежат *на одной прямой* $\vec{AB} \times \vec{AC} = 0$ то пересечение - *прямая*. Воспользуемся таким трюком: *отсортируем* концы вершин (сначала по $x$ потом по $y$) каждого отрезка: $A \le B$ и $C \le D$, то отрезком пересечения будет $[max(A, C); min(B, D)]$, если это корректно. Этот случай мы взяли так, как будто рассматриваем отрезки на прямой (так и является), где данный метод подтверждается.
- Если отрезки *пересекаются* (см. условие выше), то можно действовать также, как с прямыми: *перевести* точки в уравнение *прямых*, и найти точку пересечения.
- В остальных случаях пересечения *нет*.

![](/files/IntersectionSegments.gif)